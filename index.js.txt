const express = require('express');
const axios = require('axios');

const app = express();
app.use(express.json());

// Webhook do n8n
const N8N_WEBHOOK_URL = 'https://raphascare.app.n8n.cloud/webhook/e847a7d5-6c4e-46e6-bcb8-63585178efb0';

app.post('/zapi', async (req, res) => {
Â  const body = req.body;

Â  // Ignora grupos
Â  if (body.isGroup === true) {
Â  Â  console.log('ðŸ” Mensagem de grupo ignorada');
Â  Â  return res.status(200).send('Mensagem de grupo ignorada');
Â  }

Â  const mensagem = body.body?.toLowerCase() || '';
Â  const fromMe = body.fromMe === true;

Â  // Se for a dona
Â  if (fromMe) {
Â  Â  console.log('â„¹ï¸ Mensagem da dona ignorada');
Â  Â  return res.status(200).send('Mensagem da dona ignorada');
Â  }

Â  // Envia pro n8n
Â  try {
Â  Â  await axios.post(N8N_WEBHOOK_URL, body);
Â  Â  console.log('âœ… Mensagem enviada ao n8n');
Â  Â  res.status(200).send('Mensagem enviada');
Â  } catch (error) {
Â  Â  console.error('âŒ Erro ao enviar:', error.message);
Â  Â  res.status(500).send('Erro ao enviar ao n8n');
Â  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
Â  console.log(`ðŸš€ Middleware rodando na porta ${PORT}`);
});